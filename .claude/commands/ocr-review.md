# OCRレビュー

Codex CLIを使って、書き起こし結果をレビューする。
**Codexが利用制限の場合は、サブエージェントで代替する（スキップ禁止）。**

## 引数
- $ARGUMENTS: レビュー対象ファイルパス（省略時は直前に作成したファイル）

## 手順

1. **対象ファイル確認**
   - 引数でファイルパスが指定されていればそれを使用
   - 省略時は `pdf/output/` 内の最新ファイルを対象

2. **レビュー実行（Codex優先、使えなければサブエージェント）**

   ### 2a. Codexが使える場合
   ```bash
   codex exec "{ファイルパス} を読んで、以下の観点でレビューしてください：
   1. 明らかな誤字脱字
   2. ページ番号の連続性（飛びや重複）
   3. 構造の一貫性（見出しレベル、表記ゆれ）
   問題があれば指摘し、なければ「問題なし」と簡潔に回答。"
   ```

   ### 2b. Codexが利用制限の場合（代替：サブエージェント）
   **レビューをスキップしてはいけない。** サブエージェント（general-purpose）に依頼：
   ```
   Task tool (subagent_type: general-purpose) で以下を依頼：

   以下のファイルを読んでレビューしてください：
   {ファイルパス}

   観点：
   1. 明らかな誤字脱字
   2. ページ番号の連続性（`**p.XX**` 形式のマーカーが連続しているか）
   3. 構造の一貫性（見出しレベル、表記ゆれ）
   4. 表記ルール準拠（リスト記法が `-` か、など）

   問題があれば具体的に指摘し、なければ「問題なし」と回答してください。
   簡潔に。
   ```

3. **結果判定**
   - 「問題なし」→ 完了
   - 問題指摘あり → オーケストレーターが修正を検討

4. **ログ記録**
   - `progress/logs/reviews/{日付}-{書籍名}-{章ID}.md` に結果を記録
   - Codex/サブエージェントどちらを使用したかも記録

## Codexへのプロンプトテンプレート

```
{ファイルパス} を読んで、以下の観点でレビューしてください：

1. 明らかな誤字脱字
2. ページ番号の連続性（飛びや重複）
3. 構造の一貫性（見出しレベル、表記ゆれ）
4. 表記ルール準拠（リスト記法が `-` か、など）

【重要】ページ番号について：
- ページマーカーは `**p.XXX**` の形式で記載されている
- 「欠落」を報告する前に、実際にファイル内で該当マーカーを検索して存在を確認すること
- 存在するマーカーを「欠落」と誤報告しないこと

問題があれば具体的に指摘し、なければ「問題なし」と回答してください。
簡潔に。
```

## Codex指摘の扱い

- Codexの指摘は**修正候補**として扱う（自動的に採用しない）

### 原本確認が必須の指摘（誤検出の可能性あり）
- 括弧の閉じ忘れ・開き忘れ
- 表記ゆれ（the/The、空白の有無など）
- 見出しの空白やフォーマット
- **ページ番号の欠落**
- スタイル指摘（ダッシュの種類、括弧の形式、スペースの有無）

### 即修正可能な指摘
- 明らかなタイポ（例: 「というういつも」→「といういつも」）
- 重複した単語や文字

**原則**: 原本通りであれば「維持」、タイポは即修正OK
判断結果はレビューログに記録

## 誤検出への対応

Codexが「ページ欠落」を報告した場合：
1. まず `grep "**p.XXX**" {ファイル}` で実際の存在を確認
2. 存在すれば誤検出として無視
3. 存在しなければ原本確認へ進む

## 注意事項
- Codexはテキストベースのチェックのみ（画像との照合はしない）
- 画像との照合が必要な場合はスポットチェックで対応
- レビュー結果は必ずログに残す
