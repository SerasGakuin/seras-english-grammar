# OCRバッチ処理

複数章を連続で書き起こす。

## 引数
- $ARGUMENTS: `{書籍名}` または `{書籍名} {開始章ID} {終了章ID}`

## 使用例
```
/ocr-batch 核心              # 核心の全21章を処理
/ocr-batch 核心 Part1_01 Part1_06  # Part1_01〜Part1_06を処理
/ocr-batch 成川 Part01_01 Part01_10  # 成川162章のうち範囲指定
```

## 手順

1. **対象章の特定**
   - `progress/status.json` から書籍の章リストを取得
   - 範囲指定がある場合は該当範囲のみ
   - `status: "pending"` の章のみを対象
   - **注意**: ページ範囲は `book_pages.start` / `book_pages.end`（`pages`ではない）

2. **制限チェック**
   - 最大50章/バッチ（超過時はエラー）
   - 対象章が0の場合は終了メッセージ

3. **順次処理**
   各章について、**ocr-chapter.mdの手順1〜6を完全に実行**:

   ```
   【1章あたりの処理フロー】
   a. status.jsonから章情報を取得
   b. 画像ファイルを特定
   c. SubAgentで書き起こし → ファイル保存
   d. 【必須】Codexレビュー実行（/ocr-review）
   e. スポットチェック（該当章のみ）
   f. status.json更新
   ```

   - 1章ずつ順番に処理（並列処理しない）
   - **Codexレビューを省略しない**
   - 各章完了後に進捗を表示

4. **エラーハンドリング**
   - エラー発生時は `progress/logs/errors/` にログ
   - 3回連続エラーで処理中断、ユーザーに報告

5. **完了報告**
   - 処理済み章数
   - スキップ章数（既に完了済み）
   - エラー章数

## 進捗表示フォーマット

```
[バッチ処理開始] 核心: 21章を処理予定

[1/21] Part1_01 冠詞 ... 完了 ✓
[2/21] Part1_02 代名詞 ... 完了 ✓
[3/21] Part1_03 形容詞 ... エラー → リトライ中...
...

[バッチ処理完了]
- 完了: 20章
- スキップ: 0章
- エラー: 1章（Part1_03）
```

## 中断・再開

- 処理はいつでも中断可能（Ctrl+C）
- 再開時は同じコマンドを実行
- `status: "completed"` の章は自動スキップ

## 制限事項

- **最大50章/バッチ**: コンテキスト保護のため
- **並列処理なし**: 品質管理のため順次処理
- **自動コミットなし**: バッチ完了後にユーザーがコミット

## 注意事項

- 長時間処理になる可能性あり
- 途中経過は `progress/status.json` に随時保存
- エラーログは `progress/logs/errors/` に記録

## 品質チェックリスト（各章で確認）

各章の処理後、以下を確認してから次の章に進む：

- [ ] ページマーカー（`**p.XX**`）が全ページ分あるか
- [ ] Codexレビューを実行したか
- [ ] status.jsonの`review_status`がnull以外か
- [ ] `spot_check_required: true`の章はスポットチェックしたか
