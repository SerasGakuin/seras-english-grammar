# seras-english-grammar プロジェクト

英語参考書PDF（6冊）を高品質なMarkdownに変換するOCRプロジェクト。

---

## 🎯 プロジェクト概要

### 目的
- 英語参考書のPDFを文字データ（Markdown）に変換
- 複数LLMを使い分け、品質と効率を両立
- 長期間の作業に耐えられる一貫したワークフロー

### 対象書籍（6冊）

| 書籍名 | ファイル構成 | ステータス |
|--------|-------------|-----------|
| 核心 | 前半 + 後半 | 目次完了 |
| 成川 | 前半 + 後半 + 別冊 | 目次完了 |
| スクランブル | 前半 + 後半 | 未着手 |
| 肘井 | 本体 + 別冊 | 未着手 |
| 入門英文 | 1ファイル | 未着手 |
| はじめの英文読解ドリル | 1ファイル | 未着手 |

---

## 📁 ディレクトリ構造

```
.
├── CLAUDE.md              # このファイル（最重要）
├── .claude/
│   ├── commands/          # skills定義
│   │   ├── ocr-toc.md
│   │   ├── ocr-chapter.md
│   │   ├── ocr-review.md
│   │   └── ocr-status.md
│   └── settings.local.json # hooks設定
├── .rules/
│   ├── ocr-workflow.md    # ワークフロー詳細
│   └── notation-rules.md  # 表記ルール
├── progress/
│   ├── status.json        # 進捗管理（必ず確認）
│   └── logs/              # レビューログ
├── pdf/
│   ├── raw/               # 元PDF（横向き）
│   ├── rotated/           # 回転済みPDF（縦向き）
│   ├── images/            # 画像化したもの
│   │   └── {書籍名}/
│   └── output/            # 完成Markdown
│       └── {書籍名}/
└── scripts/
    ├── pdf_tools.py       # PDF操作ツール
    └── rotate_all.py      # 全PDF回転スクリプト
```

---

## 🔧 役割分担（重要）

| 役割 | 担当 | 責務 |
|------|------|------|
| **オーケストレーター** | Claude Code (メイン) | 全体管理、進捗追跡、品質判断、**実作業はしない** |
| **書き起こし** | Claude subagent | 画像→Markdown変換 |
| **レビュー** | Codex CLI | 誤字脱字、構造チェック |
| **前処理** | Python | PDF回転、画像化 |

### ⚠️ 最重要ルール
**オーケストレーターは画像を直接読まない。必ずsubagentに委譲する。**
これはコンテキスト保護のため。

---

## 📋 利用可能なSkills

| コマンド | 用途 |
|---------|------|
| `/ocr-toc {書籍名}` | 目次の書き起こし |
| `/ocr-chapter {書籍名} {章番号}` | 章の書き起こし |
| `/ocr-review {ファイルパス}` | Codexレビュー |
| `/ocr-status` | 進捗確認 |

---

## 📝 命名規則

### ファイル名

| 種類 | フォーマット | 例 |
|------|-------------|-----|
| 目次 | `00_目次.md` | `pdf/output/核心/00_目次.md` |
| 章 | `{Part番号}_{章番号}_{章名}.md` | `pdf/output/核心/Part1_01_冠詞.md` |
| 画像 | `page_{ページ番号}.png` | `pdf/images/核心/page_001.png` |

### 書籍名の表記
- ディレクトリ名・ファイル名では日本語をそのまま使用
- 例: `核心`, `成川`, `スクランブル`, `肘井`, `入門英文`, `はじめの英文読解ドリル`

---

## 🔄 ワークフロー

### Phase 1: 前処理
1. `scripts/rotate_all.py` で全PDFを回転
2. 必要なページを画像化（DPI: 150）

### Phase 2: 目次書き起こし
1. ユーザーに目次ページ範囲を確認
2. `/ocr-toc {書籍名}` で実行
3. subagentが画像を読み取り
4. Codexでレビュー
5. `pdf/output/{書籍名}/00_目次.md` に保存

### Phase 3: 章書き起こし
1. 目次からページ範囲を決定
2. `/ocr-chapter {書籍名} {章番号}` で実行
3. subagentが画像を読み取り
4. Codexでレビュー
5. スポットチェック（5章ごと or 最初の章）
6. `pdf/output/{書籍名}/{章ファイル名}.md` に保存
7. `progress/status.json` を更新

---

## 🚨 エラーリカバリ手順

### 画像が読めない場合
1. DPIを上げて再変換（150→200→300）
2. それでも読めなければユーザーに報告

### subagentがタイムアウト
1. ページ数を減らして再試行（10ページ→5ページ）
2. それでも失敗すればユーザーに報告

### Codexがエラーを検出
1. 指摘内容を確認
2. 軽微な修正はオーケストレーターが対応
3. 大きな問題はsubagentに再書き起こしを依頼

### 原本と大きく異なる
1. ユーザーに確認
2. 必要に応じて手動修正

### コンテキストがCompactされた場合
1. このCLAUDE.mdを最初に読む
2. `progress/status.json` で進捗を確認
3. `.rules/` でワークフロールールを確認
4. 直近の作業を継続

---

## 📊 進捗確認方法

```bash
# 進捗ファイルを確認
cat progress/status.json

# または skill を使用
/ocr-status
```

---

## 🔗 関連ファイル

- `.rules/ocr-workflow.md` - ワークフローの詳細
- `.rules/notation-rules.md` - 表記ルール（随時更新）
- `progress/status.json` - 進捗管理
- `.claude/commands/` - 各skillの詳細

---

## 💡 設計思想

1. **コンテキスト保護**: オーケストレーターは管理に徹し、実作業はsubagentに委譲
2. **状態の永続化**: 全ての状態はファイルに保存、中断・再開が可能
3. **複数LLMの協調**: Claude（書き起こし）+ Codex（レビュー）で品質担保
4. **漸進的改善**: 表記ルールは最小限から始め、必要に応じて追加
5. **一貫性**: skillsとhooksで同じ手順を毎回実行
